<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Reproductor de Audio Aleatorio</title>
</head>
<body>
  <audio controls id="audioPlayer" autoplay muted>
    Tu navegador no soporta audio.
  </audio>

  <script>
    const repo = "zokosting/QR";
    const carpeta = ""; // raíz del repositorio
    const urlBaseRaw = `https://raw.githubusercontent.com/${repo}/main/`;

    async function obtenerArchivosMP3() {
      const apiUrl = `https://api.github.com/repos/${repo}/contents/${carpeta}`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("No se pudo obtener la lista de archivos");
        const data = await response.json();
        return data
          .filter(item => item.type === "file" && item.name.toLowerCase().endsWith(".mp3"))
          .map(item => encodeURIComponent(item.name));
      } catch (error) {
        console.error("Error al obtener archivos MP3:", error);
        return [];
      }
    }

    async function reproducirAudioAleatorio() {
      const archivos = await obtenerArchivosMP3();
      if (archivos.length === 0) {
        alert("No se encontraron archivos MP3 en el repositorio.");
        return;
      }

      const elegido = archivos[Math.floor(Math.random() * archivos.length)];
      const audio = document.getElementById("audioPlayer");
      audio.innerHTML = ""; // limpia cualquier <source> previo

      const source = document.createElement("source");
      source.src = urlBaseRaw + decodeURIComponent(elegido);
      source.type = "audio/mpeg";
      audio.appendChild(source);

      audio.load();

      // Reproducir automáticamente silenciado
      try {
        await audio.play();
        // Quitar mute justo después de iniciar la reproducción
        audio.muted = false;
      } catch (err) {
        console.warn("El navegador bloqueó el autoplay:", err);
      }
    }

    reproducirAudioAleatorio();
  </script>
</body>
</html>
