<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
</head>
<body>
  <audio controls id="audioPlayer" autoplay muted>
    No audio.
  </audio>
  <script>
    const repo = "zokosting/QR";
    const carpeta = ""; // carpeta raíz
    const urlBaseRaw = `https://raw.githubusercontent.com/${repo}/main/`;

    async function obtenerArchivosMP3() {
      const apiUrl = `https://api.github.com/repos/${repo}/contents/${carpeta}`;
      try {
        const response = await fetch(apiUrl);
        if (!response.ok) throw new Error("No se pudo obtener la lista de archivos");
        const data = await response.json();

        const mp3Files = data
          .filter(item => item.type === "file" && item.name.toLowerCase().endsWith(".mp3"))
          .map(item => encodeURIComponent(item.name));

        return mp3Files;
      } catch (error) {
        console.error("Error al obtener archivos MP3:", error);
        return [];
      }
    }

    async function reproducirAudioAleatorio() {
      const archivos = await obtenerArchivosMP3();
      if (archivos.length === 0) {
        alert("No se encontraron archivos MP3 en el repositorio.");
        return;
      }

      const elegido = archivos[Math.floor(Math.random() * archivos.length)];
      const audio = document.getElementById("audioPlayer");
      audio.innerHTML = "";

      const source = document.createElement("source");
      source.src = urlBaseRaw + decodeURIComponent(elegido);
      source.type = "audio/mpeg";
      audio.appendChild(source);
      audio.load();

      // Esperar hasta que el navegador esté listo para reproducir
      audio.addEventListener("canplaythrough", () => {
        audio.play().then(() => {
          audio.muted = false;
        }).catch(err => {
          console.log("Autoplay falló:", err);
        });
      });
    }

    reproducirAudioAleatorio();
  </script>
</body>
</html>
